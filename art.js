function loadSong(n,i){song=loadSound("/assets/test"+songIndex+".mp3",function(){song.play(),song.onended(function(a){++songIndex>2&&(songIndex=0),i(songs[songIndex]),setTimeout(function(){loadSong(n,i)},2e3)}),fft.setInput(song),n(),song.rate(1)})}function setText(n){document.getElementById("song").innerHTML=n}function intro(n,i){void 0===i&&(i=0),void 0!==texts[i]?(void 0!==texts[i].t&&setText(texts[i].t),void 0!==texts[i].c&&texts[i].c(),setTimeout(function(){intro(n,i+1)},texts[i].d)):n()}function pause(){return drawCount>=drawCountMax?(drawCountMax=0,drawCountMax>10?drawCountMax=10:drawCountMax<1&&(drawCountMax=1),!1):(drawCount++,!0)}function logoKlankbord(){background(0,0,0),c0.points=12,c0.coordinates.radius=canvasSize/7.5,c0.angle=2*Math.PI/c0.points,c0.coordinates.setOptions({radius:c0.radius,angle:c0.angle});var n=calculateLineArray(11);stroke("white"),strokeWeight(1),line(n[0][0].x,n[0][0].y,n[2][0].x,n[2][0].y),line(n[2][0].x,n[2][0].y,n[4][0].x,n[4][0].y),line(n[4][0].x,n[4][0].y,n[6][0].x,n[6][0].y),line(n[6][0].x,n[6][0].y,n[8][0].x,n[8][0].y),line(n[8][0].x,n[8][0].y,n[10][0].x,n[10][0].y),line(n[10][0].x,n[10][0].y,n[0][0].x,n[0][0].y)}function logoMarjo(){background(0,0,0),c0.points=12,c1.points=12,c0.coordinates.radius=canvasSize/7.5,c1.coordinates.radius=canvasSize/15,c2.coordinates.radius=0,c0.angle=2*Math.PI/c0.points,c1.angle=2*Math.PI/c1.points,c2.angle=2*Math.PI/c2.points,c0.coordinates.setOptions({radius:c0.radius,angle:c0.angle}),c1.coordinates.setOptions({radius:c1.radius,angle:c1.angle}),c2.coordinates.setOptions({radius:c2.radius,angle:c2.angle});var n=calculateLineArray(11);stroke("white"),strokeWeight(1),line(n[0][0].x,n[0][0].y,n[4][0].x,n[4][0].y),line(n[4][0].x,n[4][0].y,n[0][2].x,n[0][2].y),line(n[4][0].x,n[4][0].y,n[8][0].x,n[8][0].y),line(n[6][0].x,n[6][0].y,n[10][0].x,n[10][0].y),line(n[6][0].x,n[6][0].y,n[0][1].x,n[0][1].y),line(n[10][0].x,n[10][0].y,n[0][1].x,n[0][1].y),line(n[0][0].x,n[0][0].y,n[2][0].x,n[2][0].y),line(n[2][0].x,n[2][0].y,n[4][0].x,n[4][0].y),line(n[4][0].x,n[4][0].y,n[6][0].x,n[6][0].y),line(n[6][0].x,n[6][0].y,n[8][0].x,n[8][0].y),line(n[8][0].x,n[8][0].y,n[10][0].x,n[10][0].y),line(n[10][0].x,n[10][0].y,n[0][0].x,n[0][0].y),c2.points=3}function logoPlay(){background(0,0,0),c0.points=12,c1.points=12,c0.coordinates.radius=canvasSize/7.5,c1.coordinates.radius=canvasSize/10,c0.angle=2*Math.PI/c0.points,c1.angle=2*Math.PI/c1.points,c0.coordinates.setOptions({radius:c0.radius,angle:c0.angle}),c1.coordinates.setOptions({radius:c1.radius,angle:c1.angle});var n=calculateLineArray(18);stroke("white"),strokeWeight(1),line(n[0][0].x,n[0][0].y,n[2][0].x,n[2][0].y),line(n[2][0].x,n[2][0].y,n[4][0].x,n[4][0].y),line(n[4][0].x,n[4][0].y,n[6][0].x,n[6][0].y),line(n[6][0].x,n[6][0].y,n[8][0].x,n[8][0].y),line(n[8][0].x,n[8][0].y,n[10][0].x,n[10][0].y),line(n[10][0].x,n[10][0].y,n[0][0].x,n[0][0].y),line(n[0][0].x,n[0][0].y,n[2][0].x,n[2][0].y),line(n[2][0].x,n[2][0].y,n[4][0].x,n[4][0].y),line(n[4][0].x,n[4][0].y,n[6][0].x,n[6][0].y),line(n[6][0].x,n[6][0].y,n[8][0].x,n[8][0].y),line(n[8][0].x,n[8][0].y,n[10][0].x,n[10][0].y),line(n[10][0].x,n[10][0].y,n[0][0].x,n[0][0].y),line(n[0][1].x,n[0][1].y,n[4][1].x,n[4][1].y),line(n[4][1].x,n[4][1].y,n[8][1].x,n[8][1].y),line(n[8][1].x,n[8][1].y,n[0][1].x,n[0][1].y),c0.points=40,c1.points=30,c2.points=10,c3.points=10,c4.points=5,c5.points=5,c6.points=5}function clearLogo(){background(0,0,0),c2.points=3}function drawVisuals(){var n=[2],i=[audioAvgOsc/4],a=[audioOsc],o=[map(audioOsc||0,200,0,200,255),map(audioOsc||0,100,0,140,120),map(audioOsc||0,200,0,0,30)],t=[255,map(audioOsc||0,200,0,255,175),map(audioOsc||0,200,0,255,0)],e=[0,map(audioOsc||0,100,0,150,220),map(audioOsc||0,100,0,150,180)],s=[0,0,0,40],r=[0,80,120];if(s=audioOsc>100?[map(audioMax||0,200,0,120,0),0,map(audioMax||0,200,0,60,0),40]:[0,0,0,40],0===lineCount){calculatePoints();var c=lcm(c0.points,c1.points),d=lcm(c2.points,c3.points);loopCount=c>d?c:d}var u=calculateLineArray(lineCount);background.apply(null,s),stroke.apply(null,r),strokeWeight.apply(null,a);for(y=0;y<u.length;y++)p=void 0===u[p=(v=y)-1]?0:p,y>0&&line(u[v][6].x,u[v][6].y,u[p][6].x,u[p][6].y);stroke.apply(null,e),strokeWeight.apply(null,n);for(var l=0;l<u.length;l++)p=void 0===u[p=(v=l)-1]?0:p,l>0&&(line(u[v][4].x,u[v][4].y,u[p][4].x,u[p][4].y),line(u[v][5].x,u[v][5].y,u[p][5].x,u[p][5].y),line(u[p][4].x,u[p][4].y,u[v][5].x,u[v][5].y));stroke.apply(null,o),strokeWeight.apply(null,n);for(var g=0;g<u.length;g+=2){var x=(v=g)-2;p=void 0===u[p=v-1]?0:p,x=void 0===u[x]?0:x,g>0&&(line(u[v][1].x,u[v][1].y,u[p][1].x,u[p][1].y),line(u[v][0].x,u[v][0].y,u[p][0].x,u[p][0].y),line(u[v][0].x,u[v][0].y,u[v][1].x,u[v][1].y),line(u[p][1].x,u[p][1].y,u[x][1].x,u[x][1].y),line(u[p][0].x,u[p][0].y,u[x][0].x,u[x][0].y),line(u[p][0].x,u[p][0].y,u[p][1].x,u[p][1].y))}stroke.apply(null,t),strokeWeight.apply(null,i);for(var y=0;y<u.length;y++){var v=y,p=v-1;p=void 0===u[p]?0:p,y>0&&(line(u[v][2].x,u[v][2].y,u[p][2].x,u[p][2].y),line(u[v][3].x,u[v][3].y,u[p][3].x,u[p][3].y),line(u[v][2].x,u[v][2].y,u[v][3].x,u[v][3].y))}!0===reverse?!1===pause(.01)&&lineCount--:!1===pause()&&(lineCount+=1),lineCount<1?(lineCount=0,reverse=!1):lineCount>loopCount&&(reverse=!0)}function calculatePoints(){c0.points=Math.round(audioAvgOsc/5),c0.points<2&&(c0.points=c0.points+2),c1.points=Math.round(getRandom(8,24)),c1.points<2&&(c1.points=c1.points+1),c2.points=Math.round(getRandom(2,12)),c2.points<2&&(c2.points=c2.points+1),c3.points=c2.points*(c2.points+1),c3.points<2&&(c3.points=c3.points+1),c4.points=c1.points,c5.points=c1.points,c6.points=c1.points;for(var n={},i=0;i<circleCount;i++){var a=window["c"+i];a.angle=2*Math.PI/a.points,a.coordinates.setOptions({radius:a.radius,angle:a.angle}),n.c1=a}return n}function calculateLineArray(n){for(a=0;a<circleCount;a++)window["c"+a].coordinates.init();for(var i=[],a=0;a<n;a++){for(var o=[],t=0;t<circleCount;t++)window["c"+t].coordinates.move(window["c"+t].direction),o.push({x:window["c"+t].coordinates.pos.x,y:window["c"+t].coordinates.pos.y});i.push(o)}return i}function analyzeAudioData(n){audioMax=audio.avgMax=getAvg(average,"max",n.max,3),audioOsc=audio.avgOsc=getAvg(average,"osc",n.osc,3),audioAvgMax=audio.avgMax=getAvg(average,"max",n.max,200),halfAvgMax=audioAvgMax/2,quarterAvgMax=audioAvgMax/4,audioAvgOsc=audio.avgOsc=getAvg(average,"osc",n.osc,100),halfAvgOsc=audioAvgOsc/4,quarterAvgOsc=audioAvgOsc/4;var i=.35*canvasSize+audioAvgOsc/4;c0.coordinates.radius=.25*canvasSize,c1.coordinates.radius=i+quarterAvgMax,c2.coordinates.radius=i,c3.coordinates.radius=.25*canvasSize-audioAvgMax/10,c4.coordinates.radius=i-audioOsc/2*audioOsc/2,c5.coordinates.radius=i+audioAvgOsc/4*(audioAvgOsc/4),c6.coordinates.radius=i+2*audioAvgOsc}function map(n,i,a,o,t){return i>a?i>n?(n-i)*(t-o)/(a-i)+o:o:a>i?a>n?(n-i)*(t-o)/(a-i)+o:t:void 0}function max(n){return Math.max.apply(null,n)}function avg(n){for(var i=0,a=0;a<n.length;a++)i+=n[a];return Math.round(i/n.length)}function getAvg(n,i,a,o){for(Array.isArray(n[i])||(n[i]=[]);n[i].length>o;)n[i].shift();return n[i].push(a),avg(n[i])}function getRandom(n,i){return Math.floor(Math.random()*(i-n))+n}function gcd(n,i){for(;i;){var a=i;i=n%i,n=a}return n}function lcm(n,i){return n=Math.abs(n),i=Math.abs(i),n&&i?Math.abs(n*i/gcd(n,i)):0}function windowResized(){canvasSize=window.innerHeight>window.innerWidth?window.innerWidth:window.innerHeight,createCanvas(window.innerWidth,window.innerHeight)}var mic,fft,first,iterator,waveformLength,analyzer,loaded,vh=1024,measurePoints=1024,songs=["Electric Tribe - unreleased demo 'So long' (2018)","Electric Tribe - 'Met de Sterren Meebewegen'","Electric Tribe - unreleased demo 'Running Electric/Euh' (2018)"],avg=function(n){for(var i=0,a=0;a<n.length;a++)i+=n[a];return i/n.length},osc=function(n,i){for(var a=0,o=0,t=0;t<n.length;t++){var e=o;n[t]>i?o=1:n[t]<i&&(o=-1),e!=o&&a++}return a},Analyzer=function(){this.analyze=function(n){var i=avg(n);return{max:Math.max.apply(null,n),avg:i,osc:osc(n,i)}},this.measureY=function(n){return(n-=vh/2)<0&&(n=-n),n}},song,songIndex=0,currentSong=songs[0];window.setupAudio=function(n){analyzer=new Analyzer,fft=new p5.FFT,"mp3"===n?loadSong(function(){loaded=!0,songReturned=!1},function(n){currentSong=n,loaded=!1}):((mic=new p5.AudioIn).start(),fft.setInput(mic),loaded=!0)};var songReturned=!1;window.drawAudio=function(){if(!0!==loaded&&!0!==songReturned)return songReturned=!0,{song:currentSong};var n=fft.waveform();first||(waveformLength=n.length,iterator=parseInt(waveformLength/measurePoints),first=!0);for(var i=[],a=0;a<waveformLength;a+=iterator){var o=map(n[a],-1,1,0,vh);i.push(analyzer.measureY(o))}return analyzer.analyze(i)};var canvasSize,calibrated={min:0,max:500,avg:100,osc:200},calibrating=!1,average={},audioMax,audioOsc,audioAvgMax,halfAvgMax,audioAvgOsc,halfAvgOsc,quarterAvgOsc,audio={},circleCount=7,drawCount=0,drawCountMax=1,lineCount=0,loopCount,reverse=!1,delay=500,texts=[{t:" ",d:500,c:clearLogo},{t:"'Klankbord'",d:2500,c:logoKlankbord},{t:"",d:500,c:clearLogo},{t:"Audio visualisation by Marius Linders and Atelier Marjolein Linders",d:2500,c:logoMarjo},{t:"",d:500,c:clearLogo},{t:"",d:2500,c:logoPlay},{t:"",d:0,c:clearLogo}];window.setupVisual=function(){canvasSize=window.innerHeight>window.innerWidth?window.innerWidth:window.innerHeight,createCanvas(window.innerWidth,window.innerHeight);for(var n=0;n<circleCount;n++)window["c"+n]={points:void 0,angle:void 0,radius:void 0,coordinates:void 0,direction:1},window["c"+n].coordinates=new Coordinates({canvas:canvas,radius:window["c"+n].radius,angle:window["c"+n].angle});c6.direction=-1,strokeJoin(MITER),noSmooth()};var drawEnabled=!1;window.drawVisual=function(n){audio=n,!1!==calibrating?calibrating.listen(n):analyzeAudioData(n),drawVisuals()};var Coordinates=function(n){return this.calculate_coordinates=function(n,i){return i=i||{x:this.canvas.width/2,y:this.canvas.height/2},i.x-=Math.sin(n>0?this.i+=this.angle:this.i-=this.angle)*this.radius,i.y+=Math.sin(n>0?this.j+=this.angle:this.j-=this.angle)*this.radius,i},this.move=function(n){return this.pos=this.calculate_coordinates(n),this},this.init=function(){this.i=0,this.j=Math.PI/2},this.setOptions=function(n){var i=!0;n.radius?this.radius=n.radius:i=!1,n.angle?this.angle=n.angle:i=!1,n.canvas&&(this.canvas=canvas),i&&this.init()},this.setOptions(n),this};
